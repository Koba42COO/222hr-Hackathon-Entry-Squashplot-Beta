<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/dashboard"></ion-back-button>
    </ion-buttons>
    <ion-title>Matrix Optimization</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div class="optimize-container">

    <!-- Configuration Card -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>Optimization Configuration</ion-card-title>
        <ion-card-subtitle>Configure your matrix optimization parameters</ion-card-subtitle>
      </ion-card-header>
      <ion-card-content>
        <form [formGroup]="optimizeForm">
          <ion-item>
            <ion-label position="stacked">Matrix Size</ion-label>
            <ion-input
              type="number"
              formControlName="matrixSize"
              (ionChange)="generateTestMatrix()"
              min="4"
              max="1024">
            </ion-input>
          </ion-item>

          <ion-item>
            <ion-checkbox formControlName="customMatrix"></ion-checkbox>
            <ion-label class="ion-margin-start">Use Custom Matrix Data</ion-label>
          </ion-item>

          <ion-item *ngIf="optimizeForm.get('customMatrix')?.value">
            <ion-label position="stacked">Matrix JSON Data</ion-label>
            <ion-textarea
              formControlName="matrixData"
              placeholder="[[1,2],[3,4]]"
              rows="4">
            </ion-textarea>
          </ion-item>
        </form>

        <!-- Theoretical Performance Preview -->
        <div class="theoretical-preview" *ngIf="!optimizeForm.get('customMatrix')?.value">
          <h4>Theoretical Performance</h4>
          <p><strong>Matrix Size:</strong> {{ matrixSize }}×{{ matrixSize }}</p>
          <p><strong>Expected Speedup:</strong> ~{{ cudntService.calculateTheoreticalPerformance(matrixSize).theoreticalSpeedup }}</p>
          <p><strong>Complexity:</strong> O(n²) → O(n^1.44)</p>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Optimization Button -->
    <ion-card>
      <ion-card-content>
        <ion-button
          expand="block"
          size="large"
          color="primary"
          [disabled]="isOptimizing || !optimizeForm.valid"
          (click)="optimizeMatrix()">
          <ion-icon name="flash" slot="start"></ion-icon>
          <span *ngIf="!isOptimizing">Optimize with CUDNT</span>
          <span *ngIf="isOptimizing">Optimizing...</span>
        </ion-button>

        <div class="optimization-status" *ngIf="isOptimizing">
          <ion-progress-bar type="indeterminate" color="primary"></ion-progress-bar>
          <p class="ion-text-center ion-margin-top">
            Applying K-Loop Production and Wallace Transform...
          </p>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Results Card -->
    <ion-card *ngIf="optimizationResult">
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="checkmark-circle" color="success"></ion-icon>
          Optimization Complete
        </ion-card-title>
        <ion-card-subtitle>CUDNT Performance Results</ion-card-subtitle>
      </ion-card-header>
      <ion-card-content>
        <ion-grid>
          <ion-row>
            <ion-col size="6">
              <div class="result-metric">
                <h2 [color]="getPerformanceColor(optimizationResult.result.performance.speedupFactor)">
                  {{ optimizationResult.result.performance.speedupFactor.toFixed(1) }}x
                </h2>
                <p>Performance Speedup</p>
              </div>
            </ion-col>
            <ion-col size="6">
              <div class="result-metric">
                <h2>{{ optimizationResult.result.performance.processingTime.toFixed(4) }}s</h2>
                <p>Processing Time</p>
              </div>
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col size="6">
              <div class="result-metric">
                <h2>{{ optimizationResult.result.performance.improvementPercent.toFixed(1) }}%</h2>
                <p>Improvement</p>
              </div>
            </ion-col>
            <ion-col size="6">
              <div class="result-metric">
                <h2>{{ optimizationResult.result.performance.consciousnessLevel }}/12</h2>
                <p>prime aligned compute Level</p>
              </div>
            </ion-col>
          </ion-row>
        </ion-grid>

        <ion-button expand="block" fill="outline" (click)="showResults()">
          <ion-icon name="information-circle" slot="start"></ion-icon>
          View Detailed Results
        </ion-button>
      </ion-card-content>
    </ion-card>

  </div>
</ion-content>
