<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    
    <ion-title>AI Chat</ion-title>
    
    <ion-buttons slot="end">
      <!-- Connection Status -->
      <ion-badge [color]="getConnectionStatusColor()" class="connection-badge">
        {{ connectionStatus }}
      </ion-badge>
      
      <!-- Provider Selector -->
      <ion-select 
        [(ngModel)]="selectedProvider" 
        (ionChange)="onProviderChange()"
        interface="popover"
        class="provider-select">
        <ion-select-option 
          *ngFor="let provider of providers" 
          [value]="provider.value">
          {{ provider.icon }} {{ provider.label }}
        </ion-select-option>
      </ion-select>
      
      <!-- Settings -->
      <ion-button fill="clear" (click)="clearConversation()">
        <ion-icon name="refresh-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="chat-content">
  
  <!-- Quick Prompts -->
  <div class="quick-prompts" *ngIf="conversation.messages.length <= 1">
    <div class="prompts-header">
      <h3>Quick Prompts</h3>
      <p>Get started with these prime aligned compute-enhanced queries:</p>
    </div>
    
    <ion-grid>
      <ion-row>
        <ion-col size="12" size-md="6" *ngFor="let prompt of quickPrompts">
          <ion-chip 
            class="quick-prompt-chip" 
            (click)="selectQuickPrompt(prompt)"
            [disabled]="isLoading">
            <ion-label>{{ prompt }}</ion-label>
          </ion-chip>
        </ion-col>
      </ion-row>
    </ion-grid>
  </div>

  <!-- Chat Messages -->
  <div class="chat-messages">
    <app-chat-message
      *ngFor="let message of conversation.messages; trackBy: trackByMessageId"
      [message]="message"
      [currentProvider]="selectedProvider"
      (copy)="copyMessage($event)"
      (share)="shareMessage($event)"
      (rate)="rateMessage($event.message, $event.rating)">
    </app-chat-message>
    
    <!-- Typing Indicator -->
    <div class="typing-indicator" *ngIf="isTyping">
      <div class="typing-avatar">
        <span class="provider-icon">{{ getProviderIcon(selectedProvider) }}</span>
      </div>
      <div class="typing-bubble">
        <div class="typing-dots">
          <span></span>
          <span></span>
          <span></span>
        </div>
        <div class="typing-text">{{ getProviderLabel(selectedProvider) }} is thinking...</div>
      </div>
    </div>
  </div>

</ion-content>

<!-- Message Input Footer -->
<ion-footer class="message-footer">
  <ion-toolbar>
    <ion-item lines="none" class="message-input-container">
      
      <!-- Attachment Button -->
      <ion-button 
        fill="clear" 
        slot="start" 
        (click)="attachFile()"
        [disabled]="isLoading">
        <ion-icon name="attach-outline"></ion-icon>
      </ion-button>
      
      <!-- Message Input -->
      <ion-textarea
        #messageInput
        [(ngModel)]="currentMessage"
        placeholder="Ask about prime aligned compute, mathematics, quantum computing..."
        rows="1"
        autoGrow="true"
        maxlength="2000"
        (keydown)="onKeyDown($event)"
        [disabled]="isLoading"
        class="message-textarea">
      </ion-textarea>
      
      <!-- Voice Input Button -->
      <ion-button 
        fill="clear" 
        slot="end" 
        (click)="startVoiceInput()"
        [disabled]="isLoading">
        <ion-icon name="mic-outline"></ion-icon>
      </ion-button>
      
      <!-- Send Button -->
      <ion-button 
        slot="end"
        [disabled]="!currentMessage.trim() || isLoading"
        (click)="sendMessage()"
        class="send-button">
        <ion-spinner name="crescent" *ngIf="isLoading"></ion-spinner>
        <ion-icon name="send-outline" *ngIf="!isLoading"></ion-icon>
      </ion-button>
      
    </ion-item>
    
    <!-- Message Counter -->
    <div class="message-counter" *ngIf="currentMessage.length > 0">
      {{ currentMessage.length }}/2000
    </div>
    
  </ion-toolbar>
</ion-footer>

