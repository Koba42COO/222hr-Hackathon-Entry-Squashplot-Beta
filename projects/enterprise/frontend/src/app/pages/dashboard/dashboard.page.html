<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>
      <ion-icon name="analytics" slot="start"></ion-icon>
      chAIos Platform Dashboard
    </ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="refreshData()">
        <ion-icon name="refresh"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Dashboard</ion-title>
    </ion-toolbar>
  </ion-header>

  <!-- System Status Overview -->
  <ion-card *ngIf="systemStatus$ | async as status">
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="pulse" slot="start"></ion-icon>
        System Status
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-grid>
        <ion-row>
          <ion-col size="6">
            <div class="metric">
              <div class="metric-value">{{ status.gateway.services }}</div>
              <div class="metric-label">Services</div>
            </div>
          </ion-col>
          <ion-col size="6">
            <div class="metric">
              <div class="metric-value">{{ status.metrics.total_requests }}</div>
              <div class="metric-label">Total Requests</div>
            </div>
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col size="6">
            <div class="metric">
              <div class="metric-value">{{ status.metrics.error_rate | percent:'1.1-1' }}</div>
              <div class="metric-label">Error Rate</div>
            </div>
          </ion-col>
          <ion-col size="6">
            <div class="metric">
              <div class="metric-value">{{ status.metrics.average_response_time | number:'1.0-2' }}s</div>
              <div class="metric-label">Avg Response</div>
            </div>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-card-content>
  </ion-card>

  <!-- Knowledge Base Stats -->
  <ion-card *ngIf="knowledgeStats$ | async as knowledge">
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="library" slot="start"></ion-icon>
        Knowledge Base
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-grid>
        <ion-row>
          <ion-col size="12">
            <div class="metric">
              <div class="metric-value">{{ knowledge.total_documents | number }}</div>
              <div class="metric-label">Total Documents</div>
            </div>
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col size="6" *ngFor="let domain of knowledge.domains | keyvalue | slice:0:4">
            <div class="domain-stat">
              <div class="domain-name">{{ domain.key | titlecase }}</div>
              <div class="domain-count">{{ domain.value }}</div>
            </div>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-card-content>
  </ion-card>

  <!-- Service Health Status -->
  <ion-card *ngIf="systemStatus$ | async as status">
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="hardware-chip" slot="start"></ion-icon>
        Service Health
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-list>
        <ion-item *ngFor="let service of status.services | keyvalue">
          <ion-icon [name]="getHealthIcon(service.value.health)" slot="start"
                   [color]="getStatusColor(service.value.health)"></ion-icon>
          <ion-label>
            <h3>{{ service.value.name }}</h3>
            <p>Status: {{ service.value.health | titlecase }}</p>
            <p *ngIf="service.value.requests">Requests: {{ service.value.requests }}</p>
          </ion-label>
          <ion-badge slot="end" [color]="getStatusColor(service.value.health)">
            {{ service.value.health | uppercase }}
          </ion-badge>
        </ion-item>
      </ion-list>
    </ion-card-content>
  </ion-card>

  <!-- Platform Tools Sections -->
  <div class="tools-sections">
    <ion-card *ngFor="let section of dashboardSections">
      <ion-card-header>
        <ion-card-title>
          <ion-icon [name]="section.icon" slot="start"></ion-icon>
          {{ section.title }}
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-list>
          <ion-item *ngFor="let item of section.items" button (click)="navigateTo(item.route)">
            <ion-icon [name]="item.icon || 'arrow-forward'" slot="start"
                     [color]="getStatusColor(item.status)"></ion-icon>
            <ion-label>
              <h3>{{ item.name }}</h3>
              <p>{{ item.description }}</p>
            </ion-label>
            <ion-badge slot="end" [color]="getStatusColor(item.status)">
              {{ item.status | titlecase }}
            </ion-badge>
            <ion-icon name="chevron-forward" slot="end"></ion-icon>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- Quick Actions -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="flash" slot="start"></ion-icon>
        Quick Actions
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-grid>
        <ion-row>
          <ion-col size="6">
            <ion-button expand="block" color="primary" (click)="navigateTo('/query')">
              <ion-icon name="search" slot="start"></ion-icon>
              New Query
            </ion-button>
          </ion-col>
          <ion-col size="6">
            <ion-button expand="block" color="secondary" (click)="navigateTo('/learning')">
              <ion-icon name="school" slot="start"></ion-icon>
              Start Learning
            </ion-button>
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col size="6">
            <ion-button expand="block" color="tertiary" (click)="navigateTo('/knowledge')">
              <ion-icon name="library" slot="start"></ion-icon>
              Browse Knowledge
            </ion-button>
          </ion-col>
          <ion-col size="6">
            <ion-button expand="block" color="success" (click)="navigateTo('/monitoring')">
              <ion-icon name="analytics" slot="start"></ion-icon>
              View Analytics
            </ion-button>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-card-content>
  </ion-card>

</ion-content>
