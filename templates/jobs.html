{% extends 'base.html' %}
{% block title %}SquashPlot Beta - Plotting Jobs{% endblock %}
{% block head %}
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}
{% block content %}
<div data-section="jobs">
    <div class="enterprise-layout">
        <!-- Enterprise Sidebar Navigation -->
        <aside class="enterprise-sidebar">
            
            <nav class="nav-menu">
                <div class="nav-section">
                    <div class="nav-section-title">Operations</div>
                    <a href="/dashboard" class="nav-item">
                        <span class="nav-icon">üìä</span>Dashboard
                    </a>
                    <a href="/jobs" class="nav-item active">
                        <span class="nav-icon">‚ö°</span>Plotting Jobs
                    </a>
                    <a href="/storage" class="nav-item">
                        <span class="nav-icon">üíæ</span>Storage
                    </a>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">Farming</div>
                    <a href="/rewards" class="nav-item">
                        <span class="nav-icon">üí∞</span>Rewards
                    </a>
                    <a href="/pools" class="nav-item">
                        <span class="nav-icon">üèä</span>Pools
                    </a>
                    <a href="/analytics" class="nav-item">
                        <span class="nav-icon">üìà</span>Analytics
                    </a>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">System</div>
                    <a href="/settings" class="nav-item">
                        <span class="nav-icon">‚öô</span>Settings
                    </a>
                    <a href="/help" class="nav-item">
                        <span class="nav-icon">‚ùì</span>Help
                    </a>
                </div>
            </nav>
        </aside>

        <!-- Enterprise Header with Job KPIs -->
        <header class="enterprise-header compact">
            <!-- Status Bar -->
            <div class="header-status">
                <div id="connection-status" class="status-indicator online">
                    <span class="status-dot online"></span>
                    <span>Connected</span>
                </div>
                
                <div class="price-ticker">
                    <div class="price-item">
                        <span class="price-label">XCH</span>
                        <span id="xch-price" class="price-value">$--</span>
                        <span id="price-change" class="price-change">--</span>
                    </div>
                    <div class="price-divider"></div>
                    <div class="price-item">
                        <span class="price-label">Netspace</span>
                        <span id="netspace" class="price-value">-- EiB</span>
                    </div>
                </div>
                
                <div id="user-profile" class="user-profile">
                    <div class="user-avatar">
                        <img id="user-avatar" src="" alt="User" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'">
                        <div class="avatar-fallback">U</div>
                    </div>
                    <div class="user-info">
                        <span id="user-name" class="user-name">Loading...</span>
                        <span id="user-farm" class="user-farm">--</span>
                    </div>
                    <div class="user-menu-toggle">‚öô</div>
                </div>
            </div>

            <!-- Section Bar -->
            <div class="section-bar">
                <h1 class="section-title">
                    <span class="section-icon">‚ö°</span>
                    Plotting Jobs Management
                </h1>
                <div class="section-actions">
                    <button class="btn-secondary">Export Log</button>
                    <button class="btn-primary">New Job</button>
                </div>
            </div>

        </header>

        <!-- Main Content Area -->
        <main class="enterprise-main">
            <!-- Job Action Bar -->
            <div class="action-bar">
                <div class="action-group">
                    <button id="new-job-btn" class="btn-primary">New Plotting Job</button>
                    <button id="batch-actions-btn" class="btn-secondary">Batch Actions</button>
                </div>
                
                <div class="action-divider"></div>
                
                <div class="action-group">
                    <label>Filter:</label>
                    <select id="job-filter" class="form-control">
                        <option value="all">All Jobs</option>
                        <option value="running">Running</option>
                        <option value="queued">Queued</option>
                        <option value="completed">Completed</option>
                        <option value="failed">Failed</option>
                    </select>
                </div>
                
                <div class="action-divider"></div>
                
                <div class="action-group">
                    <label>View:</label>
                    <button id="list-view-btn" class="btn-ghost active">List</button>
                    <button id="grid-view-btn" class="btn-ghost">Grid</button>
                </div>
                
                <div class="action-divider"></div>
                
                <div class="action-group">
                    <button id="pause-all-btn" class="btn-ghost">Pause All</button>
                    <button id="clear-completed-btn" class="btn-ghost">Clear Completed</button>
                </div>
            </div>

            <!-- Job Queue Interface -->
            <div class="card">
                <div class="card-header">
                    <h3>Job Queue</h3>
                    <div class="card-actions">
                        <button class="icon-btn" title="Refresh jobs">‚ü≤</button>
                        <button class="btn-secondary">Export Log</button>
                    </div>
                </div>
                
                <div class="job-queue-container">
                    <!-- Job List Table -->
                    <div class="job-table">
                        <div class="job-table-header">
                            <div class="job-col-status">Status</div>
                            <div class="job-col-name">Job Name</div>
                            <div class="job-col-progress">Progress</div>
                            <div class="job-col-compression">Compression</div>
                            <div class="job-col-duration">Duration</div>
                            <div class="job-col-actions">Actions</div>
                        </div>
                        
                        <div id="job-list" class="job-list">
                            <!-- Jobs will be populated here -->
                            <div class="job-row">
                                <div class="job-col-status">
                                    <span class="status-badge running">Running</span>
                                </div>
                                <div class="job-col-name">
                                    <strong>plot-k32-001</strong>
                                    <small>Mad Max ‚Ä¢ 4 cores ‚Ä¢ NVMe</small>
                                </div>
                                <div class="job-col-progress">
                                    <div class="progress-bar-mini">
                                        <div class="progress-fill" style="width: 67%"></div>
                                    </div>
                                    <span class="progress-text">67%</span>
                                </div>
                                <div class="job-col-compression">Level 3</div>
                                <div class="job-col-duration">2h 45m</div>
                                <div class="job-col-actions">
                                    <button class="btn-ghost btn-sm">Pause</button>
                                    <button class="btn-ghost btn-sm">Stop</button>
                                </div>
                            </div>
                            
                            <div class="job-row">
                                <div class="job-col-status">
                                    <span class="status-badge queued">Queued</span>
                                </div>
                                <div class="job-col-name">
                                    <strong>plot-k32-002</strong>
                                    <small>BladeBit ‚Ä¢ 8 cores ‚Ä¢ SSD</small>
                                </div>
                                <div class="job-col-progress">
                                    <div class="progress-bar-mini">
                                        <div class="progress-fill" style="width: 0%"></div>
                                    </div>
                                    <span class="progress-text">Waiting</span>
                                </div>
                                <div class="job-col-compression">Level 7</div>
                                <div class="job-col-duration">--</div>
                                <div class="job-col-actions">
                                    <button class="btn-ghost btn-sm">Priority</button>
                                    <button class="btn-ghost btn-sm">Cancel</button>
                                </div>
                            </div>
                            
                            <div class="job-row">
                                <div class="job-col-status">
                                    <span class="status-badge completed">Completed</span>
                                </div>
                                <div class="job-col-name">
                                    <strong>plot-k32-000</strong>
                                    <small>Hybrid ‚Ä¢ 6 cores ‚Ä¢ NVMe</small>
                                </div>
                                <div class="job-col-progress">
                                    <div class="progress-bar-mini">
                                        <div class="progress-fill" style="width: 100%"></div>
                                    </div>
                                    <span class="progress-text">100%</span>
                                </div>
                                <div class="job-col-compression">Level 5</div>
                                <div class="job-col-duration">3h 12m</div>
                                <div class="job-col-actions">
                                    <button class="btn-ghost btn-sm">View Log</button>
                                    <button class="btn-ghost btn-sm">Clone</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Job Templates -->
            <div class="card">
                <div class="card-header">
                    <h3>Job Templates</h3>
                    <button class="btn-secondary">Create Template</button>
                </div>
                
                <div class="template-grid">
                    <div class="template-card">
                        <h4>Speed Focus</h4>
                        <p>Mad Max, Level 0, Maximum CPU</p>
                        <div class="template-stats">
                            <span>~3.5h</span> ‚Ä¢ <span>108GB</span>
                        </div>
                        <button class="btn-primary btn-sm">Use Template</button>
                    </div>
                    
                    <div class="template-card">
                        <h4>Balanced</h4>
                        <p>Hybrid, Level 3, Medium CPU</p>
                        <div class="template-stats">
                            <span>~4.2h</span> ‚Ä¢ <span>87GB</span>
                        </div>
                        <button class="btn-primary btn-sm">Use Template</button>
                    </div>
                    
                    <div class="template-card">
                        <h4>Max Compression</h4>
                        <p>BladeBit, Level 7, High Memory</p>
                        <div class="template-stats">
                            <span>~5.1h</span> ‚Ä¢ <span>69GB</span>
                        </div>
                        <button class="btn-primary btn-sm">Use Template</button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Enterprise Insights Panel -->
        <aside class="enterprise-insights">
            <div class="insights-section">
                <h3 class="insights-title">Queue Analytics</h3>
                
                <div class="insight-item">
                    <div class="insight-metric">4.2h</div>
                    <div class="insight-description">Average job completion time</div>
                </div>
                
                <div class="insight-item">
                    <div class="insight-metric">12</div>
                    <div class="insight-description">Jobs pending in queue</div>
                </div>
                
                <div class="insight-item">
                    <div class="insight-metric">98.2%</div>
                    <div class="insight-description">Success rate (last 30 days)</div>
                </div>
            </div>

            <div class="insights-section">
                <h3 class="insights-title">Resource Utilization</h3>
                
                <div class="insight-item">
                    <div class="insight-metric">73%</div>
                    <div class="insight-description">CPU utilization average</div>
                </div>
                
                <div class="insight-item">
                    <div class="insight-metric">2.4TB</div>
                    <div class="insight-description">Temp storage in use</div>
                </div>
                
                <div class="insight-item">
                    <div class="insight-metric">6</div>
                    <div class="insight-description">Optimal concurrent jobs</div>
                </div>
            </div>

            <div class="insights-section">
                <h3 class="insights-title">Recommendations</h3>
                
                <div class="insight-item">
                    <div class="insight-description">Consider increasing queue size during off-peak hours for better throughput</div>
                </div>
                
                <div class="insight-item">
                    <div class="insight-description">BladeBit compression showing 15% better efficiency this week</div>
                </div>
            </div>

            <div class="insights-section">
                <h3 class="insights-title">Quick Actions</h3>
                
                <button class="btn-secondary" style="width: 100%; margin-bottom: var(--space-md);">
                    Quick Start Job
                </button>
                
                <button class="btn-ghost" style="width: 100%; margin-bottom: var(--space-md);">
                    Optimize Queue
                </button>
                
                <button class="btn-ghost" style="width: 100%;">
                    Export Job Report
                </button>
            </div>
        </aside>
    </div>
    <!-- Scripts -->
    <script src="/static/js/dashboard.js"></script>
    <script src="/static/js/auth-features.js"></script>
    <script src="/static/js/wallet-connect.js"></script>
</div>
{% endblock %}